"use strict";var z=Object.defineProperty;var J=(r,t,a)=>t in r?z(r,t,{enumerable:!0,configurable:!0,writable:!0,value:a}):r[t]=a;var c=(r,t,a)=>(J(r,typeof t!="symbol"?t+"":t,a),a);Object.defineProperty(exports,Symbol.toStringTag,{value:"Module"});class F{constructor({baseUrl:t,fetch:a,token:e,tenantId:s}){c(this,"baseUrl");c(this,"token");c(this,"fetch");c(this,"tenantId");this.baseUrl=t,this.fetch=a,this.token=e,this.tenantId=s}}class H extends F{constructor(t){super(t)}async getToken(t){const a=new URL(`${this.baseUrl}/sys/user/login`);return await(await this.fetch(a,{method:"post",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)})).json()}}var i=(r=>(r.material="10001001",r.document="10001002",r.changeRequest="10001003",r.changeInstruction="10001004",r.engineeringChange="10001005",r.file="10001006",r.problemReport="10001007",r.manufacturerChange="10001008",r.statusChange="10001009",r.applicationProcess="10001010",r.supplierRequest="10001011",r.manufacturer="10001012",r.manufacturerParts="10001013",r.supplier="10001014",r.projectStartChange="10001015",r.dailyNewspaper="10001019",r.projectBaselineChange="10001030",r.project="10001016",r.workReport="10001019",r.user="10001017",r.userGroup="10001018",r.manufactChange="10001020",r.technology="10001021",r.factory="10001022",r.resource="10001023",r.factoryPublish="10001024",r.resourcePublish="10001025",r.risk="10001028",r.technologyPublish="10001029",r.inspectItem="10001031",r.option="10001032",r))(i||{}),$=(r=>(r.BLANK="0",r.PENDING="1",r.ARCHIVED="2",r))($||{});class n{static isMaterial(t){return t=="10001001"}static isDocument(t){return t=="10001002"}static isChangeRequest(t){return t=="10001003"}static isChangeInstruction(t){return t=="10001004"}static isEngineeringChange(t){return t=="10001005"}static isFile(t){return t=="10001006"}static isProblemReport(t){return t=="10001007"}static isManufacturerChange(t){return t=="10001008"}static isStatusChange(t){return t=="10001009"}static isApplicationProcess(t){return t=="10001010"}static isSupplierRequest(t){return t=="10001011"}static isManufacturer(t){return t=="10001012"}static isManufacturerParts(t){return t=="10001013"}static isManufactChange(t){return t=="10001020"}static isSupplier(t){return t=="10001014"}static isProjectStartChange(t){return t=="10001015"}static isDailyNewspaper(t){return t=="10001019"}static isProjectBaselineChange(t){return t=="10001030"}static isProjectChange(t){return n.isProjectStartChange(t)||n.isProjectBaselineChange(t)}static isProject(t){return t=="10001016"}static isWorkReport(t){return t=="10001019"}static isUser(t){return t=="10001017"}static isUserGroup(t){return t=="10001018"}static isTechnology(t){return t=="10001021"}static isFactory(t){return t=="10001022"}static isResource(t){return t=="10001023"}static isTechnologyPublish(t){return t=="10001029"}static isFactoryPublish(t){return t=="10001024"}static isResoucePublish(t){return t=="10001025"}static isRisk(t){return t=="10001028"}static isInspectItem(t){return t=="10001031"}static isOption(t){return t=="10001032"}}class K{static isMaterial(t){return n.isMaterial(t.itemCode)}static isFile(t){return n.isFile(t.itemCode)}static isProject(t){return n.isProject(t.itemCode)}}const Q={[i.material]:["Relationships"],[i.document]:["Relationships"],[i.changeRequest]:["Relationships","Attachments"],[i.technology]:["Relationships"],[i.factory]:["Relationships"],[i.resource]:["Relationships","Attachments"],[i.changeInstruction]:["Relationships","Attachments"],[i.engineeringChange]:["Relationships","Attachments"],[i.file]:["Relationships"],[i.problemReport]:["Relationships","Attachments"],[i.manufacturerChange]:["Relationships","Attachments"],[i.statusChange]:["Relationships","Attachments"],[i.applicationProcess]:["Relationships","Attachments"],[i.supplierRequest]:["Relationships","Attachments"],[i.manufacturer]:["Relationships","Suppliers","MPN","Attachments"],[i.supplier]:["Relationships","Manufacturers","MPN","Attachments"],[i.manufacturerParts]:["Relationships","Suppliers"],[i.manufactChange]:["Relationships","Attachments"],[i.factoryPublish]:["Relationships","Attachments"],[i.resourcePublish]:["Relationships","Attachments"],[i.technologyPublish]:["Relationships","Attachments"],[i.project]:["WorkReport","Relationships","Attachments","TagetDeliveryLists","DeliveryLists"]};class A extends F{constructor(a){super(a);c(this,"basicReadInstanceInfo");c(this,"basicUpdateInstanceInfo");c(this,"BasicAttrs");c(this,"hasEditAuth");this.basicReadInstanceInfo,this.basicUpdateInstanceInfo,this.BasicAttrs,this.hasEditAuth}static updateBasicInstanceByAttId({value:a,instanceInfo:e,apicode:s,BasicAttrs:u}){const h=(u||[]).map(o=>s===o.apicode?{...o,value:a}:o);return{id:e==null?void 0:e.insId,itemCode:e==null?void 0:e.itemCode,tabCode:"10002001",insAttrs:h}}static getEditAndControlledState(a,e){var f;const s=a.topInstanceInfo,{tabInfo:u,isJudgeVersion:h=!0,isVersionOrderManager:d,isPreview:o}=a,b=u.tab==="WorkReport",m=u.tab==="DeliveryLists",R=e.insVersion&&e.insVersion!="Draft"&&!CHANGE_ITEMCODE.includes(Number(e.itemCode)),y=!(Q[e==null?void 0:e.itemCode]||[]).includes(u.tab),W="签出状态不能修改缴费清单和工作报告",_="没有权限",w=`流程已发布，无法编辑${u.tabName||""}`,P=`流程已取消，无法编辑${u.tabName||""}`,q=`${e.itemName||""}未签出，无法编辑${u.tabName||""}`,k=`${e.itemName||""}正在流程中，无法编辑${u.tabName||""}`,x="请切换最新的版次修改";let l={data:"",type:"warning"};const C=(()=>{var U,j,E,D,O,S,v,M,N,T,V,L;if(a.isChange||a.isAnalyse||a.isChangeDisposal)return n.isFile(e.itemCode)||d?((U=s==null?void 0:s.workflowInstance)!=null&&U.is_publish?l.data=w:(j=s==null?void 0:s.workflowInstance)!=null&&j.is_cancel?l.data=P:e.checkout||(l.data=q),!e.checkout||((E=s==null?void 0:s.workflowInstance)==null?void 0:E.is_publish)||((D=s==null?void 0:s.workflowInstance)==null?void 0:D.is_cancel)):((O=s==null?void 0:s.workflowInstance)!=null&&O.is_publish?l.data=w:(S=s==null?void 0:s.workflowInstance)!=null&&S.is_cancel&&(l.data=P),((v=s==null?void 0:s.workflowInstance)==null?void 0:v.is_publish)||((M=s==null?void 0:s.workflowInstance)==null?void 0:M.is_cancel));{let g=(e==null?void 0:e.inChangeOrderWorkflow)||((N=e==null?void 0:e.workflowInstance)==null?void 0:N.is_publish);return a.topInstanceInfo&&n.isStatusChange((T=a.topInstanceInfo)==null?void 0:T.itemCode)&&["AffectParts","AffectDocuments","AffectFiles"].includes(String((V=a.topTabInfo)==null?void 0:V.tab))&&(g=!!(e.affectedIn?e.affectedIn.split(","):[]).filter(G=>G!="SCO").length),h?((R||g)&&(e!=null&&e.inChangeOrderWorkflow?l.data=k:((L=e==null?void 0:e.workflowInstance)!=null&&L.is_publish||R)&&(l.data=w)),d||n.isFile(e.itemCode)?(e!=null&&e.checkout&&(e!=null&&e.versionOrders)&&e.currentVersionOrder==(e==null?void 0:e.versionOrders[e.versionOrders.length-1])||(l.data=x),(g||R)&&!(e!=null&&e.checkout&&(e!=null&&e.versionOrders)&&e.currentVersionOrder==(e==null?void 0:e.versionOrders[e.versionOrders.length-1]))):g||R):(g&&(l.data=k),g)}})();let p=C&&y;return e.archivingStatus==$.ARCHIVED&&["Attachments"].includes(String((f=a==null?void 0:a.topTabInfo)==null?void 0:f.tab))&&(p=!0),K.isProject(e)&&(e.projectStatusExample.isFrozen?(p=!0,l.data=_):e&&e.checkout&&!e.inChangeOrderWorkflow?((b||m)&&(l.data=W),p=b||m):p=p),n.isMaterial(e.itemCode)&&u.tab==="BOMReplace"&&(p=!1),o&&(p=!0,l.data=`预览中，无法编辑${u.tabName||""}`),{notDraftVersion:R,uneditable:C,isControlled:y,state:p,messageData:l}}initInstance(){}async getReadBasicInstanceInfo({instanceId:a,userId:e}){const{result:{pdmAttributeCustomizedVoList:s,readInstanceVo:u}}=await this.getInstanceInfo({instanceId:a,tabCode:"10002001",authType:"read",userId:e});this.basicReadInstanceInfo=u,this.BasicAttrs=s}async getUpdateBasicInstanceInfo({instanceId:a,userId:e}){const{result:{updateInstanceVo:s,hasEditAuth:u}}=await this.getInstanceInfo({instanceId:a,tabCode:"10002001",authType:"update",userId:e});this.basicUpdateInstanceInfo=s,this.hasEditAuth=u}async getInstanceInfo({instanceId:a,tabCode:e,authType:s,version:u="",versionOrder:h="",userId:d}){const o=new URL(`${this.baseUrl}/opendata/instance`);return o.search=new URLSearchParams({instanceId:a,authType:s,tabCode:e,tenantId:this.tenantId,version:u,versionOrder:h,userId:d}).toString(),await(await this.fetch(o,{method:"get",headers:{"Content-Type":"application/json",Authorization:this.token}})).json()}async updateInstanceInfo({apicode:a,value:e}){if(!this.basicReadInstanceInfo)throw new Error("清先初始化实例");const s=A.updateBasicInstanceByAttId({value:e,instanceInfo:this.basicReadInstanceInfo,apicode:a,BasicAttrs:this.BasicAttrs}),u=new URL(`${this.baseUrl}/pdm/instance`);return await(await this.fetch(u,{method:"PUT",headers:{"Content-Type":"application/json",Authorization:this.token},body:JSON.stringify({...s})})).json()}async getInstanceVersion({instanceId:a}){const e=await this.fetch(this.baseUrl+"/pdm/ins/versions").then(b=>b.json()),{result:{[a]:{versions:s,orderVersionMap:u,orders:h,orderPreVersionMap:d,versionOrderMap:o}}}=await e.json();return{versions:s,orderVersionMap:u,versionOrders:h,orderPreVersionMap:d,versionOrderMap:o}}getCommonButtonStatus({topInstanceInfo:a,tabInfo:e,instanceInfo:s,topTabInfo:u,isChange:h}){}}exports.CommonUtils=H;exports.InstanceUtils=A;
