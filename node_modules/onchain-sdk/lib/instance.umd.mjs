(function(l,n){typeof exports=="object"&&typeof module<"u"?n(exports):typeof define=="function"&&define.amd?define(["exports"],n):(l=typeof globalThis<"u"?globalThis:l||self,n(l.instance={}))})(void 0,function(l){"use strict";var Q=Object.defineProperty;var X=(l,n,R)=>n in l?Q(l,n,{enumerable:!0,configurable:!0,writable:!0,value:R}):l[n]=R;var p=(l,n,R)=>(X(l,typeof n!="symbol"?n+"":n,R),R);class n{constructor({baseUrl:t,fetch:a,token:e,tenantId:s}){p(this,"baseUrl");p(this,"token");p(this,"fetch");p(this,"tenantId");this.baseUrl=t,this.fetch=a,this.token=e,this.tenantId=s}}class R extends n{constructor(t){super(t)}async getToken(t){const a=new URL(`${this.baseUrl}/sys/user/login`);return await(await this.fetch(a,{method:"post",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)})).json()}}var i=(r=>(r.material="10001001",r.document="10001002",r.changeRequest="10001003",r.changeInstruction="10001004",r.engineeringChange="10001005",r.file="10001006",r.problemReport="10001007",r.manufacturerChange="10001008",r.statusChange="10001009",r.applicationProcess="10001010",r.supplierRequest="10001011",r.manufacturer="10001012",r.manufacturerParts="10001013",r.supplier="10001014",r.projectStartChange="10001015",r.dailyNewspaper="10001019",r.projectBaselineChange="10001030",r.project="10001016",r.workReport="10001019",r.user="10001017",r.userGroup="10001018",r.manufactChange="10001020",r.technology="10001021",r.factory="10001022",r.resource="10001023",r.factoryPublish="10001024",r.resourcePublish="10001025",r.risk="10001028",r.technologyPublish="10001029",r.inspectItem="10001031",r.option="10001032",r))(i||{}),k=(r=>(r.BLANK="0",r.PENDING="1",r.ARCHIVED="2",r))(k||{});class h{static isMaterial(t){return t=="10001001"}static isDocument(t){return t=="10001002"}static isChangeRequest(t){return t=="10001003"}static isChangeInstruction(t){return t=="10001004"}static isEngineeringChange(t){return t=="10001005"}static isFile(t){return t=="10001006"}static isProblemReport(t){return t=="10001007"}static isManufacturerChange(t){return t=="10001008"}static isStatusChange(t){return t=="10001009"}static isApplicationProcess(t){return t=="10001010"}static isSupplierRequest(t){return t=="10001011"}static isManufacturer(t){return t=="10001012"}static isManufacturerParts(t){return t=="10001013"}static isManufactChange(t){return t=="10001020"}static isSupplier(t){return t=="10001014"}static isProjectStartChange(t){return t=="10001015"}static isDailyNewspaper(t){return t=="10001019"}static isProjectBaselineChange(t){return t=="10001030"}static isProjectChange(t){return h.isProjectStartChange(t)||h.isProjectBaselineChange(t)}static isProject(t){return t=="10001016"}static isWorkReport(t){return t=="10001019"}static isUser(t){return t=="10001017"}static isUserGroup(t){return t=="10001018"}static isTechnology(t){return t=="10001021"}static isFactory(t){return t=="10001022"}static isResource(t){return t=="10001023"}static isTechnologyPublish(t){return t=="10001029"}static isFactoryPublish(t){return t=="10001024"}static isResoucePublish(t){return t=="10001025"}static isRisk(t){return t=="10001028"}static isInspectItem(t){return t=="10001031"}static isOption(t){return t=="10001032"}}class q{static isMaterial(t){return h.isMaterial(t.itemCode)}static isFile(t){return h.isFile(t.itemCode)}static isProject(t){return h.isProject(t.itemCode)}}const G={[i.material]:["Relationships"],[i.document]:["Relationships"],[i.changeRequest]:["Relationships","Attachments"],[i.technology]:["Relationships"],[i.factory]:["Relationships"],[i.resource]:["Relationships","Attachments"],[i.changeInstruction]:["Relationships","Attachments"],[i.engineeringChange]:["Relationships","Attachments"],[i.file]:["Relationships"],[i.problemReport]:["Relationships","Attachments"],[i.manufacturerChange]:["Relationships","Attachments"],[i.statusChange]:["Relationships","Attachments"],[i.applicationProcess]:["Relationships","Attachments"],[i.supplierRequest]:["Relationships","Attachments"],[i.manufacturer]:["Relationships","Suppliers","MPN","Attachments"],[i.supplier]:["Relationships","Manufacturers","MPN","Attachments"],[i.manufacturerParts]:["Relationships","Suppliers"],[i.manufactChange]:["Relationships","Attachments"],[i.factoryPublish]:["Relationships","Attachments"],[i.resourcePublish]:["Relationships","Attachments"],[i.technologyPublish]:["Relationships","Attachments"],[i.project]:["WorkReport","Relationships","Attachments","TagetDeliveryLists","DeliveryLists"]};class f extends n{constructor(a){super(a);p(this,"basicReadInstanceInfo");p(this,"basicUpdateInstanceInfo");p(this,"BasicAttrs");p(this,"hasEditAuth");this.basicReadInstanceInfo,this.basicUpdateInstanceInfo,this.BasicAttrs,this.hasEditAuth}static updateBasicInstanceByAttId({value:a,instanceInfo:e,apicode:s,BasicAttrs:u}){const d=(u||[]).map(c=>s===c.apicode?{...c,value:a}:c);return{id:e==null?void 0:e.insId,itemCode:e==null?void 0:e.itemCode,tabCode:"10002001",insAttrs:d}}static getEditAndControlledState(a,e){var D;const s=a.topInstanceInfo,{tabInfo:u,isJudgeVersion:d=!0,isVersionOrderManager:g,isPreview:c}=a,m=u.tab==="WorkReport",P=u.tab==="DeliveryLists",A=e.insVersion&&e.insVersion!="Draft"&&!CHANGE_ITEMCODE.includes(Number(e.itemCode)),C=!(G[e==null?void 0:e.itemCode]||[]).includes(u.tab),x="签出状态不能修改缴费清单和工作报告",z="没有权限",y=`流程已发布，无法编辑${u.tabName||""}`,j=`流程已取消，无法编辑${u.tabName||""}`,J=`${e.itemName||""}未签出，无法编辑${u.tabName||""}`,U=`${e.itemName||""}正在流程中，无法编辑${u.tabName||""}`,H="请切换最新的版次修改";let o={data:"",type:"warning"};const E=(()=>{var O,S,v,M,N,T,V,L,F,$,W,_;if(a.isChange||a.isAnalyse||a.isChangeDisposal)return h.isFile(e.itemCode)||g?((O=s==null?void 0:s.workflowInstance)!=null&&O.is_publish?o.data=y:(S=s==null?void 0:s.workflowInstance)!=null&&S.is_cancel?o.data=j:e.checkout||(o.data=J),!e.checkout||((v=s==null?void 0:s.workflowInstance)==null?void 0:v.is_publish)||((M=s==null?void 0:s.workflowInstance)==null?void 0:M.is_cancel)):((N=s==null?void 0:s.workflowInstance)!=null&&N.is_publish?o.data=y:(T=s==null?void 0:s.workflowInstance)!=null&&T.is_cancel&&(o.data=j),((V=s==null?void 0:s.workflowInstance)==null?void 0:V.is_publish)||((L=s==null?void 0:s.workflowInstance)==null?void 0:L.is_cancel));{let w=(e==null?void 0:e.inChangeOrderWorkflow)||((F=e==null?void 0:e.workflowInstance)==null?void 0:F.is_publish);return a.topInstanceInfo&&h.isStatusChange(($=a.topInstanceInfo)==null?void 0:$.itemCode)&&["AffectParts","AffectDocuments","AffectFiles"].includes(String((W=a.topTabInfo)==null?void 0:W.tab))&&(w=!!(e.affectedIn?e.affectedIn.split(","):[]).filter(K=>K!="SCO").length),d?((A||w)&&(e!=null&&e.inChangeOrderWorkflow?o.data=U:((_=e==null?void 0:e.workflowInstance)!=null&&_.is_publish||A)&&(o.data=y)),g||h.isFile(e.itemCode)?(e!=null&&e.checkout&&(e!=null&&e.versionOrders)&&e.currentVersionOrder==(e==null?void 0:e.versionOrders[e.versionOrders.length-1])||(o.data=H),(w||A)&&!(e!=null&&e.checkout&&(e!=null&&e.versionOrders)&&e.currentVersionOrder==(e==null?void 0:e.versionOrders[e.versionOrders.length-1]))):w||A):(w&&(o.data=U),w)}})();let b=E&&C;return e.archivingStatus==k.ARCHIVED&&["Attachments"].includes(String((D=a==null?void 0:a.topTabInfo)==null?void 0:D.tab))&&(b=!0),q.isProject(e)&&(e.projectStatusExample.isFrozen?(b=!0,o.data=z):e&&e.checkout&&!e.inChangeOrderWorkflow?((m||P)&&(o.data=x),b=m||P):b=b),h.isMaterial(e.itemCode)&&u.tab==="BOMReplace"&&(b=!1),c&&(b=!0,o.data=`预览中，无法编辑${u.tabName||""}`),{notDraftVersion:A,uneditable:E,isControlled:C,state:b,messageData:o}}initInstance(){}async getReadBasicInstanceInfo({instanceId:a,userId:e}){const{result:{pdmAttributeCustomizedVoList:s,readInstanceVo:u}}=await this.getInstanceInfo({instanceId:a,tabCode:"10002001",authType:"read",userId:e});this.basicReadInstanceInfo=u,this.BasicAttrs=s}async getUpdateBasicInstanceInfo({instanceId:a,userId:e}){const{result:{updateInstanceVo:s,hasEditAuth:u}}=await this.getInstanceInfo({instanceId:a,tabCode:"10002001",authType:"update",userId:e});this.basicUpdateInstanceInfo=s,this.hasEditAuth=u}async getInstanceInfo({instanceId:a,tabCode:e,authType:s,version:u="",versionOrder:d="",userId:g}){const c=new URL(`${this.baseUrl}/opendata/instance`);return c.search=new URLSearchParams({instanceId:a,authType:s,tabCode:e,tenantId:this.tenantId,version:u,versionOrder:d,userId:g}).toString(),await(await this.fetch(c,{method:"get",headers:{"Content-Type":"application/json",Authorization:this.token}})).json()}async updateInstanceInfo({apicode:a,value:e}){if(!this.basicReadInstanceInfo)throw new Error("清先初始化实例");const s=f.updateBasicInstanceByAttId({value:e,instanceInfo:this.basicReadInstanceInfo,apicode:a,BasicAttrs:this.BasicAttrs}),u=new URL(`${this.baseUrl}/pdm/instance`);return await(await this.fetch(u,{method:"PUT",headers:{"Content-Type":"application/json",Authorization:this.token},body:JSON.stringify({...s})})).json()}async getInstanceVersion({instanceId:a}){const e=await this.fetch(this.baseUrl+"/pdm/ins/versions").then(m=>m.json()),{result:{[a]:{versions:s,orderVersionMap:u,orders:d,orderPreVersionMap:g,versionOrderMap:c}}}=await e.json();return{versions:s,orderVersionMap:u,versionOrders:d,orderPreVersionMap:g,versionOrderMap:c}}getCommonButtonStatus({topInstanceInfo:a,tabInfo:e,instanceInfo:s,topTabInfo:u,isChange:d}){}}l.CommonUtils=R,l.InstanceUtils=f,Object.defineProperty(l,Symbol.toStringTag,{value:"Module"})});
